# AgentBase v1.0

<img width="100%" alt="Снимок экрана 2024-10-21 в 11 25 11" src="https://github.com/user-attachments/assets/31885cba-84c6-4da6-b25d-2050f8803f91">

### Описание
Эта программа предназначена для автоматизированного сбора данных о компаниях, включая контактную информацию, из нескольких источников (налоговая служба, Тинькофф API, Чекко). Программа выполняет парсинг данных по заданным ОГРН, регионам, видам деятельности, и собирает ключевые реквизиты компании, телефоны, электронные почты и веб-сайты. Итоговые данные можно экспортировать в формате Excel и упаковать в ZIP-архив для интеграции с системами вроде ELMA.

### Особенности
- **Запросы к внешним API**: программа запрашивает данные компаний через сервисы ЕГРЮЛ (сбор ОГРН действующих организаций), Тинькофф (сбор основных данных организаций) и Чеко (сбор контактных данных).
- **Обработка контактов**: программа извлекает телефоны, email и веб-сайты компаний.
- **Экспорт данных**: собранные данные могут быть экспортированы в JSON, Excel или ZIP-архив для ELMA для удобства использования в корпоративных системах.
- **Живые логи**: во время работы приложения отображается прогресс выполнения и ошибки через сервер отправки логов в реальном времени. Также запись логов ведется в папку logs.
- **Поочередная обработка**: сбор информации происходит так, что не вредит серверам ресурсов, с которых производит парсинг, так как скорость сбора данных не превышает 3 организации в секунду с паузами каждые 100 элементов.

### Технологии
- **Express** — серверная платформа для Node.js.
- **Axios** — для выполнения HTTP-запросов к API и веб-страницам.
- **Cheerio** — для парсинга HTML-страниц и извлечения данных.
- **XLSX** — для генерации Excel-файлов.
- **Archiver** — для создания ZIP-архивов.
- **FS и Path** — для работы с файлами и логами.

### Установка и запуск
1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/cloverfield11/inn-ogrn-parcer
    cd inn-ogrn-parcer
    ```
2. Установите зависимости:
    ```bash
    npm install
    ```
3. Запустите сервер:
    ```bash
    node app.js
    ```
4. Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000).

### Настройки (необязательно)
Можно сменить заголовки для HTTP-запросов, используемые при обращении к сервисам ЕГРЮЛ, Тинькофф и Чекко. Также можно настроить список ФИО ответственных за контрагента в дальнейшем (присваивается один ко многим)

### Логи
Программа ведет логи запросов и событий в папке `logs`. Логи можно также просматривать в режиме реального времени через GET-запрос по адресу `/logs`.

### Пример использования
1. Запросите данные организаций по региону и виду деятельности с помощью POST-запроса на `/fetch-organizations`.
2. Полученные данные можно скачать в формате Excel через `/download-excel`.
3. Для интеграции с системой ELMA воспользуйтесь маршрутом `/download-elma`.

## Тестирование ПО на получение статистики потерянных/отсутствующих данных

### Тест 1: Работа с VPN (Нидерланды)

**Выборка:** Категория "Образование" (Тюменская область, ЯНАО)

| Источник         | Элементов собрано | Процент обработки |
| ---------------- | ----------------- | ----------------- |
| ЕГРЮЛ            | 1335              | 100%              |
| Тинькофф.Бизнес  | 1335              | 100%              |
| Чекко            | 1333              | 99.85%            |

**Средняя скорость сбора данных:** 2 элемента/сек  
**Процент отсутствия контактных данных:** Телефон: 6.7%, Почта: 7.8%

### Тест 2: Множественный выбор категорий с VPN

**Выборка:** "Добыча нефти", "Пищевые продукты", и другие (Тюменская область, ХМАО, ЯНАО)

| Источник         | Элементов собрано | Процент обработки |
| ---------------- | ----------------- | ----------------- |
| ЕГРЮЛ            | 1048              | 100%              |
| Тинькофф.Бизнес  | 1048              | 100%              |
| Чекко            | 1048              | 100%              |

**Средняя скорость сбора данных:** 1.7 элемента/сек  
**Процент отсутствия контактных данных:** Телефон: 12.1%, Почта: 26.8%

### Тест 3: Без VPN

**Выборка:** "Добыча нефти и газа" (Тюменская область, ХМАО, ЯНАО)

| Источник         | Элементов собрано | Процент обработки |
| ---------------- | ----------------- | ----------------- |
| ЕГРЮЛ            | 99                | 100%              |
| Тинькофф.Бизнес  | 99                | 100%              |
| Чекко            | 99                | 100%              |

**Средняя скорость сбора данных:** 3 элемента/сек  
**Процент отсутствия контактных данных:** Телефон: 5.1%, Почта: 17.2%

---

### Лицензия
Этот проект распространяется под лицензией MIT.
